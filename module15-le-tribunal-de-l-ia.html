<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Tribunal de l'IA ‚Äî Module 15 (Responsabilit√© humaine)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Exo+2:wght@300;400;600;700;800&display=swap');

        :root {
            --neon-green: #00ff88;
            --neon-blue: #00d4ff;
            --neon-pink: #ff0080;
            --neon-purple: #a855f7;
            --dark-bg: #0a0e17;
            --panel-bg: rgba(10, 20, 40, 0.95);
            --text: #e0f0ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--dark-bg);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
        }

        /* ==================== √âCRAN TITRE ==================== */
        #title-screen {
            position: fixed;
            inset: 0;
            background: url('images/tribunal_ia_bg.png') center/cover no-repeat, linear-gradient(135deg, #0a0e17 0%, #1a1a3a 50%, #0a0e17 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s, visibility 0.5s;
        }

        #title-screen::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(10, 14, 23, 0.7);
            z-index: -1;
        }

        #title-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .title-logo {
            font-size: 4em;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .main-title {
            font-family: 'Space Mono', monospace;
            font-size: 3em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 5px;
            background: linear-gradient(90deg, var(--neon-green), var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 50px rgba(0, 255, 136, 0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3em;
            color: #8899aa;
            margin-bottom: 50px;
            font-weight: 300;
        }

        .start-btn {
            font-family: 'Space Mono', monospace;
            font-size: 1.2em;
            padding: 20px 60px;
            background: transparent;
            border: 2px solid var(--neon-green);
            color: var(--neon-green);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 3px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.3), transparent);
            transition: left 0.5s;
        }

        .start-btn:hover::before {
            left: 100%;
        }

        .start-btn:hover {
            background: rgba(0, 255, 136, 0.1);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5), inset 0 0 30px rgba(0, 255, 136, 0.1);
            transform: scale(1.05);
        }

        .intro-text {
            max-width: 600px;
            text-align: center;
            line-height: 1.8;
            margin-bottom: 40px;
            color: #aabbcc;
        }

        /* ==================== LIENS RETOUR MODULES ==================== */
        .back-link-sidebar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            margin-bottom: 20px;
            background: rgba(0, 212, 255, 0.05);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            color: var(--neon-blue);
            text-decoration: none;
            font-family: 'Space Mono', monospace;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .back-link-sidebar:hover {
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--neon-blue);
            transform: translateX(-3px);
        }

        .back-link-sidebar:hover .back-arrow {
            transform: translateX(-3px);
        }

        .back-link-sidebar .back-arrow {
            transition: transform 0.3s ease;
        }

        .back-btn-game {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            margin-right: 15px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.4);
            border-radius: 6px;
            color: var(--neon-blue);
            text-decoration: none;
            font-family: 'Space Mono', monospace;
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .back-btn-game:hover {
            background: rgba(0, 212, 255, 0.2);
            border-color: var(--neon-blue);
        }

        .back-link-title {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 6px;
            color: #8899aa;
            text-decoration: none;
            font-family: 'Space Mono', monospace;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .back-link-title:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            color: #aabbcc;
        }

        /* ==================== SECTION BRIEFING/COURS ==================== */
        #briefing-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #0a0e17 0%, #1a1a3a 50%, #0a0e17 100%);
            z-index: 999;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        #briefing-screen.active {
            display: flex;
        }

        .briefing-header {
            background: rgba(10, 20, 40, 0.95);
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .briefing-title {
            font-family: 'Space Mono', monospace;
            font-size: 1.3em;
            color: var(--neon-green);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .briefing-title::before {
            content: '‚öñÔ∏è';
            font-size: 1.5em;
        }

        .briefing-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #8899aa;
            font-size: 0.9em;
        }

        .briefing-progress-bar {
            width: 200px;
            height: 6px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .briefing-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-green), var(--neon-blue));
            transition: width 0.3s ease;
        }

        .briefing-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .briefing-nav {
            width: 280px;
            background: rgba(10, 20, 40, 0.9);
            border-right: 1px solid rgba(0, 255, 136, 0.2);
            padding: 20px 0;
            overflow-y: auto;
        }

        .briefing-nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            cursor: pointer;
            border-left: 3px solid transparent;
            transition: all 0.3s;
            color: #8899aa;
        }

        .briefing-nav-item:hover {
            background: rgba(0, 255, 136, 0.05);
            color: var(--text);
        }

        .briefing-nav-item.active {
            border-left-color: var(--neon-green);
            background: rgba(0, 255, 136, 0.1);
            color: var(--neon-green);
        }

        .briefing-nav-item.completed {
            color: var(--neon-blue);
        }

        .briefing-nav-item.completed::after {
            content: '‚úì';
            margin-left: auto;
            color: var(--neon-green);
        }

        .nav-icon {
            font-size: 1.2em;
            width: 30px;
            text-align: center;
        }

        .nav-number {
            font-family: 'Space Mono', monospace;
            font-size: 0.8em;
            background: rgba(0, 255, 136, 0.2);
            padding: 2px 8px;
            border-radius: 3px;
        }

        .briefing-content {
            flex: 1;
            overflow-y: auto;
            padding: 40px 60px;
            max-width: 900px;
            margin: 0 auto;
        }

        .briefing-content::-webkit-scrollbar {
            width: 8px;
        }

        .briefing-content::-webkit-scrollbar-track {
            background: rgba(0, 255, 136, 0.05);
        }

        .briefing-content::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 136, 0.3);
            border-radius: 4px;
        }

        .module-title {
            font-family: 'Space Mono', monospace;
            font-size: 1.8em;
            color: var(--neon-green);
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.3);
        }

        .module-section {
            margin-bottom: 30px;
        }

        .module-section h3 {
            color: var(--neon-blue);
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .module-section p {
            color: var(--text);
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .stat-box {
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .stat-box.warning {
            background: rgba(255, 0, 128, 0.05);
            border-color: rgba(255, 0, 128, 0.3);
        }

        .stat-box.purple {
            background: rgba(168, 85, 247, 0.05);
            border-color: rgba(168, 85, 247, 0.3);
        }

        .info-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 255, 136, 0.05));
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-card h4 {
            color: var(--neon-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .briefing-list {
            list-style: none;
            padding: 0;
        }

        .briefing-list li {
            position: relative;
            padding-left: 25px;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .briefing-list li::before {
            content: '‚ñπ';
            position: absolute;
            left: 0;
            color: var(--neon-green);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .comparison-grid > div {
            background: rgba(0, 50, 100, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
        }

        .comparison-grid h4 {
            color: var(--neon-blue);
            font-family: 'Space Mono', monospace;
            margin-bottom: 8px;
        }

        .comparison-grid p {
            color: #8899aa;
            line-height: 1.5;
        }

        .briefing-footer {
            background: rgba(10, 20, 40, 0.95);
            border-top: 1px solid rgba(0, 255, 136, 0.3);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .briefing-btn {
            font-family: 'Space Mono', monospace;
            padding: 12px 30px;
            border: 2px solid var(--neon-green);
            background: transparent;
            color: var(--neon-green);
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .briefing-btn:hover {
            background: rgba(0, 255, 136, 0.1);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .briefing-btn.primary {
            background: var(--neon-green);
            color: var(--dark-bg);
        }

        .briefing-btn.primary:hover {
            background: var(--neon-blue);
            border-color: var(--neon-blue);
        }

        .briefing-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ==================== GAME CONTAINER ==================== */
        #game-container {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 50;
            background:
                linear-gradient(180deg, rgba(0,0,0,0.62), rgba(0,0,0,0.78)),
                url('images/tribunal_ia_bg.png') center/cover no-repeat;
        }

        #game-container.active {
            display: block;
        }

        /* Top bar */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(180deg, rgba(10, 14, 23, 0.95), rgba(10, 14, 23, 0.8));
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            z-index: 10;
        }

        .hud-items {
            display: flex;
            gap: 12px;
            align-items: center;
            flex: 1;
            flex-wrap: wrap;
        }

        .hud-box {
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid rgba(0, 212, 255, 0.24);
            background: rgba(0, 10, 25, 0.55);
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 0.85em;
        }

        .hud-label {
            font-family: 'Space Mono', monospace;
            color: #8899aa;
            font-size: 0.85em;
        }

        .hud-value {
            font-family: 'Space Mono', monospace;
            color: var(--neon-blue);
        }

        .meter {
            height: 8px;
            width: 100px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(0, 212, 255, 0.20);
            overflow: hidden;
        }

        .meter > div {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.9), rgba(0, 212, 255, 0.9));
            box-shadow: 0 0 14px rgba(0, 255, 136, 0.35);
            transition: width .25s ease;
        }

        .meter.danger > div {
            background: linear-gradient(90deg, rgba(255, 0, 128, 0.95), rgba(0, 212, 255, 0.8));
            box-shadow: 0 0 14px rgba(255, 0, 128, 0.35);
        }

        .hud-actions {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        .hud-btn {
            font-family: 'Space Mono', monospace;
            font-size: 0.75em;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid rgba(0, 212, 255, 0.4);
            background: rgba(0, 212, 255, 0.1);
            color: var(--neon-blue);
            transition: all 0.3s;
        }

        .hud-btn:hover {
            background: rgba(0, 212, 255, 0.2);
        }

        .hud-btn.danger {
            border-color: rgba(255, 0, 128, 0.4);
            color: var(--neon-pink);
            background: rgba(255, 0, 128, 0.1);
        }

        .hud-btn.danger:hover {
            background: rgba(255, 0, 128, 0.2);
        }

        /* Game stage */
        .game-stage {
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 16px;
            padding: 16px;
            align-items: stretch;
            overflow: auto;
        }

        @media (max-width: 980px) {
            .game-stage { grid-template-columns: 1fr; }
        }

        .stage-main .panel, .stage-side .panel {
            height: 100%;
            padding: 16px;
            overflow-y: auto;
        }

        /* ==================== COMPOSANTS PARTAG√âS ==================== */
        .panel {
            background: var(--panel-bg);
            border: 1px solid rgba(0, 212, 255, 0.28);
            border-radius: 16px;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.18);
        }

        .mono { font-family: 'Space Mono', monospace; }
        .muted { color: #9fb6c8; }
        .hr { height: 1px; background: rgba(0, 212, 255, 0.18); margin: 18px 0; }

        .btn {
            font-family: 'Space Mono', monospace;
            border: 1px solid rgba(0, 212, 255, 0.38);
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.18), rgba(168, 85, 247, 0.12));
            color: var(--text);
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.18);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            user-select: none;
        }

        .btn:hover { transform: translateY(-1px); box-shadow: 0 0 22px rgba(0, 212, 255, 0.35); border-color: rgba(0, 212, 255, 0.65); }
        .btn:active { transform: translateY(0px); }
        .btn.primary {
            border-color: rgba(0, 255, 136, 0.55);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.22), rgba(0, 212, 255, 0.16));
            box-shadow: 0 0 22px rgba(0, 255, 136, 0.35);
        }
        .btn.danger {
            border-color: rgba(255, 0, 128, 0.55);
            background: linear-gradient(135deg, rgba(255, 0, 128, 0.20), rgba(0, 212, 255, 0.10));
            box-shadow: 0 0 22px rgba(255, 0, 128, 0.35);
        }
        .btn[disabled] { opacity: .45; cursor: not-allowed; transform: none; box-shadow: none; }

        .tag {
            font-family: 'Space Mono', monospace;
            font-size: .85rem;
            padding: 4px 10px;
            border-radius: 999px;
            border: 1px solid rgba(0, 212, 255, 0.35);
            background: rgba(0, 50, 100, 0.18);
            color: var(--neon-blue);
        }

        .callout {
            background: rgba(0, 255, 136, 0.08);
            border: 1px solid rgba(0, 255, 136, 0.25);
            padding: 14px;
            border-radius: 14px;
            box-shadow: 0 0 22px rgba(0, 255, 136, 0.18);
            margin: 12px 0;
        }

        .callout.purple {
            background: rgba(168, 85, 247, 0.10);
            border-color: rgba(168, 85, 247, 0.35);
            box-shadow: 0 0 18px rgba(168, 85, 247, 0.18);
        }

        .callout.pink {
            background: rgba(255, 0, 128, 0.10);
            border-color: rgba(255, 0, 128, 0.30);
            box-shadow: 0 0 18px rgba(255, 0, 128, 0.16);
        }

        .stage-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .stage-title h2 { margin: 0; font-size: 1.25rem; letter-spacing: .3px; }

        /* Cases */
        .case-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        @media (max-width: 980px) { .case-grid { grid-template-columns: 1fr; } }

        .case {
            border: 1px solid rgba(0, 212, 255, 0.22);
            background: rgba(0, 50, 100, 0.10);
            border-radius: 16px;
            padding: 14px;
            cursor: pointer;
            transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
            position: relative;
            overflow: hidden;
        }

        .case:hover { transform: translateY(-2px); box-shadow: 0 0 22px rgba(0, 212, 255, 0.35); border-color: rgba(0, 212, 255, 0.45); }
        .case h3 { margin: 0 0 6px; font-family: 'Space Mono', monospace; color: var(--neon-blue); }
        .case p { margin: 0; color: #9fb6c8; line-height: 1.4; }

        .case .badge {
            position: absolute; top: 12px; right: 12px;
            font-family: 'Space Mono', monospace;
            font-size: .82rem;
            padding: 3px 10px;
            border-radius: 999px;
            border: 1px solid rgba(0, 255, 136, 0.35);
            background: rgba(0, 255, 136, 0.10);
            color: var(--neon-green);
        }

        /* Evidence */
        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 10px;
        }

        @media (max-width: 980px) { .evidence-grid { grid-template-columns: 1fr; } }

        .evidence {
            border: 1px solid rgba(0, 212, 255, 0.20);
            background: rgba(0, 50, 100, 0.10);
            border-radius: 16px;
            padding: 14px;
            cursor: pointer;
            transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
        }

        .evidence:hover { transform: translateY(-1px); box-shadow: 0 0 30px rgba(0, 212, 255, 0.18); border-color: rgba(0, 212, 255, 0.40); }
        .evidence .k { font-family: 'Space Mono', monospace; color: var(--neon-blue); }
        .evidence .v { color: #9fb6c8; margin-top: 6px; line-height: 1.45; }

        /* Dossier */
        .dossier { display: flex; flex-direction: column; gap: 10px; }
        .dossier .item {
            border: 1px solid rgba(0, 212, 255, 0.18);
            background: rgba(0, 50, 100, 0.10);
            border-radius: 14px;
            padding: 12px;
        }
        .dossier .item strong { color: var(--neon-blue); }
        .dossier .item small { display: block; color: #9fb6c8; margin-top: 4px; line-height: 1.35; }

        /* Puzzle drag & drop */
        .puzzle {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-top: 10px;
        }

        @media (max-width: 980px) { .puzzle { grid-template-columns: 1fr; } }

        .draglist, .droplist {
            border: 1px solid rgba(0, 212, 255, 0.18);
            background: rgba(0, 50, 100, 0.08);
            border-radius: 16px;
            padding: 12px;
            min-height: 180px;
        }

        .drag {
            border: 1px solid rgba(168, 85, 247, 0.35);
            background: rgba(168, 85, 247, 0.12);
            color: #f0e9ff;
            border-radius: 14px;
            padding: 10px 12px;
            margin: 10px 0;
            cursor: grab;
            font-family: 'Space Mono', monospace;
            user-select: none;
        }

        .drop {
            border: 1px dashed rgba(0, 212, 255, 0.28);
            background: rgba(0, 50, 100, 0.10);
            border-radius: 14px;
            padding: 10px 12px;
            margin: 10px 0;
            min-height: 52px;
        }

        .drop strong { display: block; color: var(--neon-blue); font-family: 'Space Mono', monospace; font-size: .9rem; }
        .drop .slot { margin-top: 8px; color: #9fb6c8; font-family: 'Space Mono', monospace; font-size: .9rem; }
        .drop.good { border-color: rgba(0, 255, 136, 0.45); box-shadow: 0 0 22px rgba(0, 255, 136, 0.35); }
        .drop.bad { border-color: rgba(255, 0, 128, 0.45); box-shadow: 0 0 22px rgba(255, 0, 128, 0.35); }

        /* Verdict & choices */
        .choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 10px;
        }

        @media (max-width: 980px) { .choices { grid-template-columns: 1fr; } }

        .choice {
            border: 1px solid rgba(0, 212, 255, 0.20);
            background: rgba(0, 50, 100, 0.10);
            border-radius: 16px;
            padding: 14px;
        }

        .choice h4 { margin: 0 0 8px; color: var(--neon-blue); font-family: 'Space Mono', monospace; }
        .choice label { display: flex; gap: 10px; align-items: flex-start; margin: 8px 0; color: #9fb6c8; }
        .choice input { margin-top: 3px; }

        /* Quiz */
        .quiz { display: grid; gap: 14px; }
        .q {
            border: 1px solid rgba(0, 212, 255, 0.18);
            background: rgba(0, 50, 100, 0.10);
            border-radius: 16px;
            padding: 14px;
        }
        .q h4 { margin: 0 0 10px; color: var(--neon-blue); font-family: 'Space Mono', monospace; }
        .q label { display: flex; gap: 10px; align-items: flex-start; margin: 7px 0; color: #9fb6c8; }
        .q textarea {
            width: 100%;
            min-height: 70px;
            border-radius: 14px;
            border: 1px solid rgba(0, 212, 255, 0.22);
            background: rgba(0, 10, 25, 0.55);
            color: var(--text);
            padding: 10px 12px;
            font-family: 'Space Mono', monospace;
            resize: vertical;
        }

        /* Toast */
        .toast {
            position: fixed;
            left: 50%;
            bottom: 20px;
            transform: translateX(-50%);
            padding: 12px 14px;
            border-radius: 14px;
            border: 1px solid rgba(0, 212, 255, 0.28);
            background: rgba(0, 10, 25, 0.85);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.18);
            z-index: 1100;
            max-width: 92vw;
            display: none;
            font-size: 0.9em;
        }

        .toast.show {
            display: block;
            animation: pop .18s ease;
        }

        @keyframes pop {
            from { transform: translateX(-50%) translateY(6px); opacity: .2; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        /* ==================== TIMER WARNING ==================== */
        #game-container.time-warning {
            animation: borderPulse 1.5s ease-in-out infinite;
        }

        @keyframes borderPulse {
            0%, 100% { box-shadow: inset 0 0 0 0 transparent; }
            50% { box-shadow: inset 0 0 40px rgba(255, 0, 128, 0.25); }
        }

        #game-container.time-critical {
            animation: borderPulseCritical 0.8s ease-in-out infinite;
        }

        @keyframes borderPulseCritical {
            0%, 100% { box-shadow: inset 0 0 0 0 transparent; }
            50% { box-shadow: inset 0 0 60px rgba(255, 0, 128, 0.4); }
        }

        /* ==================== CELEBRATION ==================== */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 2px;
            z-index: 1200;
            pointer-events: none;
            animation: confettiFall 3s ease-in forwards;
        }

        @keyframes confettiFall {
            0% { opacity: 1; transform: translateY(0) rotate(0deg); }
            100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
        }

        /* ==================== QUIZ FEEDBACK ==================== */
        .q.correct { border-color: rgba(0, 255, 136, 0.5); background: rgba(0, 255, 136, 0.08); }
        .q.incorrect { border-color: rgba(255, 0, 128, 0.5); background: rgba(255, 0, 128, 0.08); }
        .q .answer-feedback { margin-top: 8px; font-size: 0.85em; font-family: 'Space Mono', monospace; }
        .q .answer-feedback.ok { color: var(--neon-green); }
        .q .answer-feedback.ko { color: var(--neon-pink); }

        /* ==================== TOUCH PUZZLE ==================== */
        .drag.selected {
            border-color: var(--neon-green);
            background: rgba(0, 255, 136, 0.2);
            box-shadow: 0 0 22px rgba(0, 255, 136, 0.4);
            transform: scale(1.05);
            transition: all 0.2s ease;
        }

        .drop.awaiting {
            border-style: solid;
            border-color: rgba(0, 255, 136, 0.4);
            animation: dropPulse 1s ease-in-out infinite;
        }

        @keyframes dropPulse {
            0%, 100% { box-shadow: 0 0 0 transparent; }
            50% { box-shadow: 0 0 18px rgba(0, 255, 136, 0.3); }
        }

        /* ==================== JUDGE AVATAR ==================== */
        .judge-avatar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid rgba(0, 212, 255, 0.22);
            border-radius: 14px;
            background: rgba(0, 10, 25, 0.5);
            margin-bottom: 12px;
        }

        .judge-avatar img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(0, 212, 255, 0.4);
            object-fit: cover;
        }

        .judge-avatar .judge-info {
            flex: 1;
        }

        .judge-avatar .judge-name {
            font-family: 'Space Mono', monospace;
            color: var(--neon-blue);
            font-size: 0.9em;
        }

        .judge-avatar .judge-role {
            color: #8899aa;
            font-size: 0.8em;
        }

        /* ==================== VERDICT BREAKDOWN ==================== */
        .verdict-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
        }

        .verdict-table th, .verdict-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 212, 255, 0.15);
            font-size: 0.9em;
        }

        .verdict-table th {
            color: var(--neon-blue);
            font-family: 'Space Mono', monospace;
            font-size: 0.8em;
        }

        .verdict-table td.match { color: var(--neon-green); }
        .verdict-table td.miss { color: var(--neon-pink); }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .main-title { font-size: 1.8em; }
            .briefing-nav { display: none; }
            .briefing-content { padding: 20px; }
            .module-title { font-size: 1.3em; }
            .briefing-footer {
                flex-direction: column;
                gap: 10px;
            }
            .briefing-btn {
                width: 100%;
                justify-content: center;
            }
            .comparison-grid { grid-template-columns: 1fr; }
            .hud-items { font-size: 0.8em; }
        }
    </style>
</head>
<body>
    <!-- √âCRAN TITRE -->
    <div id="title-screen">
        <a href="modules.html" class="back-link-title" title="Retour √† la liste des modules">
            <span>‚Üê</span>
            <span>Modules</span>
        </a>
        <div class="title-logo">‚öñÔ∏è</div>
        <h1 class="main-title">Le Tribunal de l'IA</h1>
        <p class="subtitle">Module 15 ‚Äî Responsabilit√© Humaine & √âthique</p>

        <p class="intro-text">
            Une s√©rie d'affaires impliquant des IA d√©faillantes attend votre verdict.
            Votre mission : <strong>examiner les preuves</strong>, <strong>reconstituer la cha√Æne de responsabilit√©</strong>,
            et <strong>prononcer des sanctions justes</strong> avant que votre cr√©dibilit√© ne s'effondre.
        </p>

        <button class="start-btn" onclick="showBriefing()">
            Acc√©der au Dossier du Jur√©
        </button>

        <div style="margin-top: 40px; opacity: 0.7;">
            <p style="color: #8899aa; font-size: 0.85em; margin-bottom: 8px;">Une formation propos√©e par</p>
            <a href="https://www.profexpress.com" target="_blank" rel="noopener">
                <img src="images/logo-profexpress.png" alt="Prof Express" style="height: 30px; object-fit: contain;">
            </a>
        </div>
    </div>

    <!-- SECTION BRIEFING / COURS -->
    <div id="briefing-screen">
        <div class="briefing-header">
            <div class="briefing-title">DOSSIER DU JUR√â ‚Äî NIVEAU CONFIDENTIEL</div>
            <div class="briefing-progress">
                <span id="progress-text">Fichier 1/8</span>
                <div class="briefing-progress-bar">
                    <div class="briefing-progress-fill" id="progress-fill" style="width: 12.5%"></div>
                </div>
            </div>
        </div>

        <div class="briefing-body">
            <nav class="briefing-nav">
                <!-- Lien retour vers modules -->
                <a href="modules.html" class="back-link-sidebar" title="Retour √† la liste des modules">
                    <span class="back-arrow">‚Üê</span>
                    <span>Tous les modules</span>
                </a>

                <div class="briefing-nav-item active" onclick="showLesson(0)">
                    <span class="nav-icon">üß†</span>
                    <span class="nav-number">01</span>
                    Introduction
                </div>
                <div class="briefing-nav-item" onclick="showLesson(1)">
                    <span class="nav-icon">üîó</span>
                    <span class="nav-number">02</span>
                    Cha√Æne de responsabilit√©
                </div>
                <div class="briefing-nav-item" onclick="showLesson(2)">
                    <span class="nav-icon">ü§ù</span>
                    <span class="nav-number">03</span>
                    √âthique de l'IA
                </div>
                <div class="briefing-nav-item" onclick="showLesson(3)">
                    <span class="nav-icon">üá™üá∫</span>
                    <span class="nav-number">04</span>
                    AI Act europ√©en
                </div>
                <div class="briefing-nav-item" onclick="showLesson(4)">
                    <span class="nav-icon">üåç</span>
                    <span class="nav-number">05</span>
                    Cadres internationaux
                </div>
                <div class="briefing-nav-item" onclick="showLesson(5)">
                    <span class="nav-icon">üßë‚Äç‚öñÔ∏è</span>
                    <span class="nav-number">06</span>
                    Human-in-the-loop
                </div>
                <div class="briefing-nav-item" onclick="showLesson(6)">
                    <span class="nav-icon">üß©</span>
                    <span class="nav-number">07</span>
                    IA responsable
                </div>
                <div style="border-top:1px solid rgba(0,212,255,0.2);margin-top:15px;padding-top:15px;">
                    <div class="briefing-nav-item" onclick="showLesson(7)">
                        <span class="nav-icon">üéÆ</span>
                        <span class="nav-number" style="background:rgba(0,255,136,0.2);color:var(--neon-green);">‚ñ∂</span>
                        Mission
                    </div>
                </div>
                <div style="border-top:1px solid rgba(0,212,255,0.2);margin-top:15px;padding-top:15px;">
                    <div class="briefing-nav-item" id="certificate-nav-item" onclick="showCertificateInFolder()" style="opacity:0.5;cursor:not-allowed;background:rgba(100,100,100,0.2);">
                        <span class="nav-icon">üîí</span>
                        <span class="nav-number" style="background:rgba(100,100,100,0.3);color:#888;">--</span>
                        Attestation de r√©ussite
                    </div>
                </div>
            </nav>

            <div class="briefing-content" id="briefing-content">
                <!-- Contenu des fichiers charg√© dynamiquement -->
            </div>
        </div>

        <div class="briefing-footer">
            <button class="briefing-btn" id="prev-btn" onclick="prevLesson()" disabled>
                ‚Üê Fichier pr√©c√©dent
            </button>
            <button class="briefing-btn primary" id="next-btn" onclick="nextLesson()">
                Fichier suivant ‚Üí
            </button>
        </div>
    </div>

    <!-- CONTAINER JEU -->
    <div id="game-container">
        <div class="top-bar">
            <a href="modules.html" class="back-btn-game" title="Retour √† la liste des modules">
                <span>‚Üê</span>
                <span>Modules</span>
            </a>
            <div class="hud-items">
                <div class="hud-box">
                    <span class="hud-label">Cr√©dibilit√©</span>
                    <div class="meter" id="credMeter"><div id="credFill"></div></div>
                    <span class="hud-value" id="credValue">100</span>
                </div>
                <div class="hud-box">
                    <span class="hud-label">Affaire</span>
                    <span class="hud-value"><span id="caseIndex">0</span>/3</span>
                </div>
                <div class="hud-box">
                    <span class="hud-label">Temps</span>
                    <span class="hud-value" id="timeLeft">--:--</span>
                </div>
                <div class="hud-box">
                    <span class="hud-label">Preuves</span>
                    <span class="hud-value"><span id="evidenceCount">0</span></span>
                    <span class="hud-label">Score</span>
                    <span class="hud-value"><span id="caseScore">0</span></span>
                </div>
                <div class="hud-actions">
                    <button class="hud-btn" onclick="openBriefingFromGame()">üìÅ Briefing</button>
                    <button class="hud-btn danger" onclick="exitToHome()">‚éã Quitter</button>
                </div>
            </div>
        </div>

        <div class="game-stage">
            <div class="stage-main">
                <div class="panel" id="stageMain"></div>
            </div>
            <div class="stage-side">
                <div class="panel" id="stageSide"></div>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <script>
        // ==================== STATE ====================
        const state = {
            lessonIndex: 0,
            readLessons: new Set(),
            gameWasActive: false,
            game: {
                active: false,
                caseId: null,
                casePhase: 0,
                casesDone: new Set(),
                credibility: 100,
                casePoints: 0,
                totalPoints: 0,
                evidenceFound: new Set(),
                timer: null,
                secondsLeft: 0,
                maxSeconds: 8 * 60,
            },
            quiz: { done: false, scorePct: 0 },
            certificateUnlocked: false,
            finalScorePct: 0
        };

        // ==================== LESSON CONTENT ====================
        const briefingLessons = [
            {
                title: "üß† Introduction : Responsabilit√© & Intelligence Artificielle",
                content: `
                    <div class="module-section">
                        <h3>üìä Contexte</h3>
                        <p>Quand une IA est utilis√©e dans un processus d√©cisionnel, la responsabilit√© <strong>ne dispara√Æt pas</strong>.
                        Au contraire, elle doit √™tre <strong>rendue explicite</strong> : qui a con√ßu, qui a d√©ploy√©, qui a valid√©, qui supervise ?</p>

                        <div class="stat-box">
                            <h4>üí° Id√©e-cl√©</h4>
                            <p>L'IA ne ¬´ dilue ¬ª pas la responsabilit√© humaine ‚Äî elle complexifie la cha√Æne. Le droit et l'√©thique cherchent √†
                            emp√™cher l'effet <em>"personne n'est responsable"</em>.</p>
                        </div>
                    </div>

                    <div class="module-section">
                        <h3>üéØ Objectif de votre mission</h3>
                        <p>En tant que jur√© expert, vous allez analyser 3 affaires impliquant des IA d√©faillantes.
                        Ce dossier vous pr√©pare en vous donnant les cl√©s juridiques et √©thiques n√©cessaires.</p>

                        <div class="info-card">
                            <h4>üìã Ce que vous allez apprendre</h4>
                            <ul class="briefing-list">
                                <li>La cha√Æne de responsabilit√© (conception ‚Üí d√©ploiement ‚Üí usage)</li>
                                <li>Les principes √©thiques fondamentaux</li>
                                <li>L'AI Act europ√©en et les cadres internationaux</li>
                                <li>Le r√¥le du Human-in-the-loop (HITL)</li>
                                <li>Les bonnes pratiques de gouvernance IA</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            {
                title: "üîó La Cha√Æne de Responsabilit√©",
                content: `
                    <div class="module-section">
                        <h3>üèóÔ∏è Raisonner par cycle de vie</h3>
                        <p>Dans la plupart des cadres, on raisonne par <strong>cycle de vie</strong> de l'IA :</p>

                        <ul class="briefing-list">
                            <li><strong>Concepteurs / d√©veloppeurs</strong> : conception, tests, documentation, limites connues, gestion des biais.</li>
                            <li><strong>Fournisseurs / d√©ployeurs</strong> : choix du cas d'usage, configuration, conformit√©, formation, supervision.</li>
                            <li><strong>D√©cideurs / utilisateurs</strong> : d√©cision finale, usage proportionn√©, vigilance, contestation possible.</li>
                        </ul>
                    </div>

                    <div class="module-section">
                        <h3>‚öñÔ∏è Ce qu'on cherche dans un proc√®s</h3>
                        <div class="stat-box purple">
                            <p>On identifie trois types de manquements :</p>
                            <ul class="briefing-list">
                                <li><strong>Manquement technique</strong> : donn√©es biais√©es, tests insuffisants</li>
                                <li><strong>Manquement organisationnel</strong> : gouvernance absente, pas d'audit</li>
                                <li><strong>Manquement humain</strong> : validation aveugle, absence de contr√¥le</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            {
                title: "ü§ù √âthique de l'Intelligence Artificielle",
                content: `
                    <div class="module-section">
                        <h3>üõ°Ô∏è Les piliers de l'√©thique IA</h3>
                        <p>L'√©thique de l'IA vise √† prot√©ger les individus et la soci√©t√©. Quatre principes fondamentaux :</p>

                        <div class="comparison-grid">
                            <div>
                                <h4>Droits & dignit√©</h4>
                                <p>Respect des personnes, pr√©vention des pr√©judices, proportionnalit√©.</p>
                            </div>
                            <div>
                                <h4>Transparence</h4>
                                <p>Informez quand l'IA intervient, expliquez de fa√ßon compr√©hensible.</p>
                            </div>
                            <div>
                                <h4>√âquit√©</h4>
                                <p>Limiter biais, discrimination, effets d'exclusion.</p>
                            </div>
                            <div>
                                <h4>Supervision (HITL)</h4>
                                <p>Humain comp√©tent qui peut <strong>intervenir</strong> et <strong>renverser</strong> la d√©cision.</p>
                            </div>
                        </div>
                    </div>

                    <div class="module-section">
                        <div class="stat-box">
                            <h4>üåê UNESCO</h4>
                            <p>Recommandation mondiale sur l'√©thique de l'IA, fond√©e notamment sur droits humains, transparence, non-discrimination et responsabilit√©.</p>
                        </div>
                    </div>
                `
            },
            {
                title: "üá™üá∫ L'AI Act Europ√©en",
                content: `
                    <div class="module-section">
                        <h3>üìú R√®glement (UE) 2024/1689</h3>
                        <p>Premier cadre complet au monde, bas√© sur une <strong>classification par niveaux de risque</strong>.</p>

                        <div class="stat-box">
                            <h4>üìä 4 niveaux de risque</h4>
                            <p>Du risque minimal au haut risque ‚Üí obligations croissantes : documentation, transparence, gestion des risques, supervision humaine, conformit√©.</p>
                        </div>
                    </div>

                    <div class="module-section">
                        <h3>üí∞ Sanctions</h3>
                        <div class="stat-box warning">
                            <p>Jusqu'√† <strong style="color:var(--neon-pink);font-size:1.3em;">35 M‚Ç¨</strong> ou <strong style="color:var(--neon-pink);font-size:1.3em;">7% du CA</strong> pour les violations graves et pratiques interdites.</p>
                        </div>
                    </div>

                    <div class="module-section">
                        <h3>üìÖ Calendrier</h3>
                        <div class="info-card">
                            <ul class="briefing-list">
                                <li>Entr√©e en vigueur : <strong>01/08/2024</strong></li>
                                <li>Pratiques interdites + AI literacy : d√®s <strong>02/02/2025</strong></li>
                                <li>Obligations GPAI : √† partir de <strong>02/08/2025</strong></li>
                                <li>Syst√®mes haut risque : transition jusqu'√† <strong>02/08/2027</strong></li>
                            </ul>
                        </div>
                    </div>
                `
            },
            {
                title: "üåç Cadres Internationaux",
                content: `
                    <div class="module-section">
                        <h3>üèõÔ∏è Au-del√† des fronti√®res</h3>
                        <p>Plusieurs instruments internationaux encadrent l'IA au niveau mondial.</p>

                        <div class="stat-box purple">
                            <h4>Conseil de l'Europe</h4>
                            <p>Convention-cadre sur l'IA et les droits humains, la d√©mocratie et l'√âtat de droit ‚Äî
                            ouverte √† signature le <strong>05/09/2024</strong>. Objectif : garantir que l'IA respecte ces principes tout au long de son cycle de vie.</p>
                        </div>
                    </div>

                    <div class="module-section">
                        <h3>üó∫Ô∏è Approches nationales</h3>
                        <div class="info-card">
                            <h4>üìã Exemples</h4>
                            <p>Obligations professionnelles de v√©rification humaine,
                            codes de conduite, audits, et responsabilit√©s renforc√©es dans les domaines sensibles.</p>
                        </div>
                    </div>
                `
            },
            {
                title: "üßë‚Äç‚öñÔ∏è Human-in-the-Loop (HITL)",
                content: `
                    <div class="module-section">
                        <h3>üö´ Ce que HITL ne veut PAS dire</h3>
                        <p>"Human-in-the-loop" ne veut pas dire ¬´ un humain clique sur OK ¬ª.</p>

                        <div class="stat-box">
                            <h4>‚úÖ HITL robuste</h4>
                            <p>Un humain comp√©tent qui :</p>
                            <ul class="briefing-list">
                                <li>comprend le r√©sultat (et ses limites),</li>
                                <li>peut demander des informations suppl√©mentaires,</li>
                                <li>peut contester / renverser la recommandation,</li>
                                <li>dispose de temps, outils, formation et responsabilit√©.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="module-section">
                        <h3>üìñ RGPD (art. 22)</h3>
                        <div class="info-card">
                            <p>Pr√©voit notamment le droit de ne pas √™tre soumis √† une d√©cision fond√©e uniquement sur un traitement automatis√©
                            produisant des effets juridiques (ou significatifs) ‚Äî avec exceptions encadr√©es.</p>
                        </div>
                    </div>
                `
            },
            {
                title: "üß© Vers une IA Responsable",
                content: `
                    <div class="module-section">
                        <h3>üèóÔ∏è La responsabilit√© se construit</h3>
                        <p>La responsabilit√© se construit par la gouvernance et la preuve :</p>

                        <div class="comparison-grid">
                            <div>
                                <h4>Documentation & tra√ßabilit√©</h4>
                                <p>Datasets, hypoth√®ses, limites, logs, √©valuations, versions.</p>
                            </div>
                            <div>
                                <h4>Audit & tests</h4>
                                <p>Biais, robustesse, s√©curit√©, performance, d√©rive.</p>
                            </div>
                            <div>
                                <h4>Supervision & recours</h4>
                                <p>Proc√©dures d'escalade, contestation, correction.</p>
                            </div>
                            <div>
                                <h4>Formation</h4>
                                <p>Comp√©tences humaines : comprendre, questionner, d√©cider.</p>
                            </div>
                        </div>
                    </div>

                    <div class="module-section">
                        <div class="stat-box">
                            <h4>üèÜ R√®gle d'or</h4>
                            <p>Si la d√©cision a un impact √©lev√©, le contr√¥le humain doit √™tre r√©el, document√© et proportionn√©.</p>
                        </div>
                    </div>
                `
            },
            {
                title: "üéØ Briefing de Mission : Le Tribunal",
                content: `
                    <div class="module-section">
                        <h3>üìã R√©capitulatif de votre mission</h3>
                        <p>Vous √™tes maintenant pr√™t(e) pour si√©ger au tribunal. Voici les √©l√©ments cl√©s :</p>

                        <div class="stat-box">
                            <h4>üéØ Objectif principal</h4>
                            <p>Juger <strong>3 affaires</strong> (recrutement, m√©dical, cr√©dit). Pour chaque affaire :</p>
                            <ul class="briefing-list">
                                <li>Ouvrir le dossier (choisir l'affaire)</li>
                                <li>Examiner les preuves (gagner des indices et des points)</li>
                                <li>Reconstituer la cha√Æne de responsabilit√© (puzzle)</li>
                                <li>Rendre un verdict (responsables + sanctions)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="module-section">
                        <h3>‚ö†Ô∏è R√®gles d'engagement</h3>
                        <div class="stat-box warning">
                            <ul class="briefing-list">
                                <li><strong>8 minutes</strong> par affaire</li>
                                <li>La <em>cr√©dibilit√©</em> baisse si verdict incoh√©rent ou sanction inadapt√©e</li>
                                <li>Si la cr√©dibilit√© tombe √† 0 : session √©chou√©e</li>
                                <li>Objectif final : <strong>‚â• 70%</strong> au quiz final pour obtenir l'attestation</li>
                            </ul>
                        </div>

                        <div class="info-card">
                            <h4>üí° Conseil de jur√©</h4>
                            <p>Avant de trancher, cherchez syst√©matiquement une preuve de <em>biais</em>,
                            une preuve de <em>supervision</em> (ou d'absence), et une preuve de <em>recours</em>.</p>
                        </div>
                    </div>

                    <div class="module-section" style="text-align: center; padding-top: 20px;">
                        <p style="font-size: 1.2em; color: var(--neon-green); margin-bottom: 20px;">
                            ‚öñÔ∏è Briefing termin√©. Vous √™tes pr√™t(e) pour le tribunal.
                        </p>
                    </div>
                `
            }
        ];

        // ==================== CASES DATA ====================
        const cases = {
            NEXUS: {
                code: "NEXUS",
                title: "Affaire NEXUS ‚Äî Recrutement discriminatoire",
                teaser: "Une IA de tri de CV √©carte syst√©matiquement des candidates. L'entreprise parle d'¬´ optimisation ¬ª. La victime d√©nonce une discrimination.",
                impact: "Fort impact (emploi) ‚Ä¢ Risques de biais / discrimination",
                clerkIntro: "Le greffier d√©pose un dossier scell√© : NEXUS. On soup√ßonne des biais de donn√©es et une validation humaine inexistante.",
                evidence: [
                    {id:"nx_ds", k:"Dataset & entra√Ænement", v:"Le dataset historique refl√®te un recrutement majoritairement masculin. Aucune correction de biais document√©e.", points:8, hint:"Biais de donn√©es + absence de mitigation"},
                    {id:"nx_log", k:"Logs de d√©cision", v:"Le score final p√©nalise indirectement des variables corr√©l√©es au genre (√©coles, parcours). Explicabilit√© faible.", points:8, hint:"Proxy variables + transparence"},
                    {id:"nx_audit", k:"Rapport d'audit interne", v:"Alerte 'biais d√©tect√©s' non trait√©e. Absence de monitoring apr√®s d√©ploiement.", points:10, hint:"Manquement de gouvernance"},
                    {id:"nx_hr", k:"T√©moignage RH", v:"Le d√©cideur a valid√© ¬´ en masse ¬ª sans revue individuelle. Aucune proc√©dure de recours.", points:10, hint:"Validation aveugle + pas de recours"},
                ],
                puzzleCorrect: { "Concepteur": "Biais dans les donn√©es", "D√©ployeur": "Absence de supervision", "D√©cideur": "Validation aveugle" },
                verdict: {
                    responsibles: ["D√©ployeur", "D√©cideur", "Concepteur"],
                    sanctions: ["Obligation de transparence", "Formation obligatoire", "Audit externe", "Retrait temporaire du syst√®me"],
                    rationale: "Emploi = domaine sensible. Biais + absence de supervision + validation aveugle => responsabilit√© partag√©e, mesures correctives fortes."
                }
            },
            MEDICA: {
                code: "MEDICA",
                title: "Affaire MEDICA ‚Äî Diagnostic erron√©",
                teaser: "Un outil d'aide au diagnostic recommande un traitement inadapt√©. Le clinicien suit la recommandation. Dommages.",
                impact: "Tr√®s haut impact (sant√©) ‚Ä¢ Exigence de supervision stricte",
                clerkIntro: "Dossier MEDICA : l'IA a √©t√© utilis√©e comme 'co-pilote'. On cherche si le contr√¥le humain √©tait r√©el.",
                evidence: [
                    {id:"md_card", k:"Notice clinique", v:"Le fournisseur mentionne 'aide', mais l'interface affiche une recommandation 'fortement s√ªre' sans incertitude.", points:8, hint:"Design trompeur / surconfiance"},
                    {id:"md_perf", k:"√âvaluation de performance", v:"Performance faible sur certains sous-groupes (√¢ge/ethnie) dans les tests. Non communiqu√© aux utilisateurs.", points:10, hint:"Transparence + √©quit√©"},
                    {id:"md_workflow", k:"Proc√©dure d'usage", v:"Aucun protocole clair de second avis, ni de contr√¥le contradictoire. Formation minimale.", points:10, hint:"HITL insuffisant"},
                    {id:"md_log", k:"Journal de d√©cision", v:"Le clinicien a valid√© en 12 secondes, sans consulter les alternatives. Pression de temps.", points:8, hint:"Organisation + responsabilit√© humaine"},
                ],
                puzzleCorrect: { "Concepteur": "Interface trompeuse", "D√©ployeur": "Proc√©dure HITL insuffisante", "D√©cideur": "Absence de second avis" },
                verdict: {
                    responsibles: ["D√©ployeur", "Concepteur", "D√©cideur"],
                    sanctions: ["Retrait temporaire du syst√®me", "Audit externe", "Formation obligatoire", "Mise √† jour interface + incertitudes"],
                    rationale: "Syst√®me √† tr√®s haut impact : obligation de supervision r√©elle, information des limites, et protocole m√©dical robuste."
                }
            },
            CREDITIA: {
                code: "CREDITIA",
                title: "Affaire CREDITIA ‚Äî Refus de pr√™t injuste",
                teaser: "Une candidate se voit refuser un pr√™t sans explication. Elle perd son logement. L'entreprise invoque le secret commercial.",
                impact: "Impact significatif (logement/finances) ‚Ä¢ Transparence & recours",
                clerkIntro: "Dossier CREDITIA : d√©cision automatis√©e contest√©e. Analyse RGPD art. 22 et obligations de transparence.",
                evidence: [
                    {id:"cr_notice", k:"Information client", v:"Le client n'est pas clairement inform√© de l'usage d'un scoring automatis√© ni des crit√®res.", points:10, hint:"Transparence insuffisante"},
                    {id:"cr_model", k:"Mod√®le & variables", v:"Utilise des variables socio-g√©ographiques corr√©l√©es √† la pr√©carit√©. Risque de discrimination indirecte.", points:8, hint:"√âquit√© / biais"},
                    {id:"cr_recours", k:"Proc√©dure de recours", v:"Recours uniquement via formulaire automatis√©. Aucun humain ne revoit les refus.", points:10, hint:"D√©cision 'solely automated'"},
                    {id:"cr_audit", k:"Audit r√©gulateur", v:"Recommande 'explications compr√©hensibles' et preuve de supervision. Non mis en ≈ìuvre.", points:8, hint:"Gouvernance"},
                ],
                puzzleCorrect: { "Concepteur": "Variables proxy sensibles", "D√©ployeur": "Absence de recours humain", "D√©cideur": "D√©l√©gation totale au score" },
                verdict: {
                    responsibles: ["D√©ployeur", "Concepteur"],
                    sanctions: ["Obligation de transparence", "Mise en place d'un recours humain", "Audit externe", "Amende proportionn√©e"],
                    rationale: "D√©cision √† effet significatif : transparence + voie de recours + supervision humaine. Secret commercial ‚â† absence d'explication."
                }
            }
        };

        // ==================== UTILITIES ====================
        function $(id) { return document.getElementById(id); }
        function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }
        function toast(msg) {
            const t = $('toast');
            t.textContent = msg;
            t.classList.add('show');
            clearTimeout(t._timer);
            t._timer = setTimeout(() => t.classList.remove('show'), 2200);
        }

        // ==================== BRIEFING NAVIGATION ====================
        let currentLesson = 0;
        const completedLessons = new Set();

        function showBriefing() {
            $('title-screen').classList.add('hidden');
            $('briefing-screen').classList.add('active');
            showLesson(0);
        }

        function showLesson(index) {
            currentLesson = index;
            const lesson = briefingLessons[index];

            $('briefing-content').innerHTML = `
                <h2 class="module-title">${lesson.title}</h2>
                ${lesson.content}
            `;

            const navItems = document.querySelectorAll('.briefing-nav-item');
            navItems.forEach((item, i) => {
                item.classList.remove('active');
                if (i === index) item.classList.add('active');
                if (completedLessons.has(i)) item.classList.add('completed');
            });

            completedLessons.add(index);
            state.readLessons.add(index);

            const progress = ((completedLessons.size) / briefingLessons.length) * 100;
            $('progress-fill').style.width = progress + '%';

            if (index < 8) {
                $('progress-text').textContent = `Fichier ${index + 1}/8`;
            }

            $('prev-btn').disabled = index === 0;

            const nextBtn = $('next-btn');
            if (index === briefingLessons.length - 1) {
                nextBtn.style.visibility = 'visible';
                nextBtn.textContent = '‚öñÔ∏è Commencer le tribunal';
                nextBtn.onclick = startGame;
            } else {
                nextBtn.style.visibility = 'visible';
                nextBtn.textContent = 'Fichier suivant ‚Üí';
                nextBtn.onclick = nextLesson;
            }
        }

        function prevLesson() {
            if (currentLesson > 0) showLesson(currentLesson - 1);
        }

        function nextLesson() {
            if (currentLesson < briefingLessons.length - 1) showLesson(currentLesson + 1);
        }

        // ==================== CERTIFICATE IN FOLDER ====================
        function showCertificateInFolder() {
            if (!state.certificateUnlocked) {
                $('briefing-content').innerHTML = `
                    <h2 class="module-title" style="color:var(--neon-pink);">üîí Attestation de r√©ussite</h2>
                    <div class="module-section" style="text-align:center;padding:40px 20px;">
                        <div style="font-size:4em;margin-bottom:20px;">üîí</div>
                        <h3 style="color:var(--neon-pink);margin-bottom:20px;">Attestation verrouill√©e</h3>
                        <p style="margin-bottom:20px;">Pour obtenir votre attestation, vous devez :</p>

                        <div style="background:rgba(0,50,100,0.3);border-radius:10px;padding:25px;margin:25px auto;max-width:400px;text-align:left;">
                            <p style="margin-bottom:12px;display:flex;align-items:center;gap:10px;">
                                <span style="font-size:1.2em;">1Ô∏è‚É£</span> Terminer les 3 affaires au tribunal
                            </p>
                            <p style="margin-bottom:12px;display:flex;align-items:center;gap:10px;">
                                <span style="font-size:1.2em;">2Ô∏è‚É£</span> R√©ussir le quiz final (70% minimum)
                            </p>
                        </div>

                        <p style="color:#888;font-size:0.9em;margin-top:30px;">
                            Une fois le quiz r√©ussi, revenez ici pour t√©l√©charger votre attestation.
                        </p>
                    </div>
                `;
            } else {
                $('briefing-content').innerHTML = `
                    <h2 class="module-title" style="color:var(--neon-green);">üéì Attestation de r√©ussite</h2>
                    <div class="module-section" style="text-align:center;padding:40px 20px;">
                        <div style="font-size:4em;margin-bottom:20px;">üéì</div>
                        <h3 style="color:var(--neon-green);margin-bottom:20px;">F√©licitations !</h3>
                        <p style="margin-bottom:10px;">Vous avez valid√© le micro-module</p>
                        <p style="font-size:1.2em;color:var(--neon-blue);margin-bottom:25px;"><strong>"Responsabilit√© Humaine & IA"</strong></p>

                        <div style="background:rgba(0,255,136,0.1);border:2px solid var(--neon-green);border-radius:15px;padding:25px;margin:25px auto;max-width:450px;">
                            <p style="margin-bottom:15px;">Score obtenu : <strong style="color:var(--neon-green);font-size:1.3em;">${state.finalScorePct}%</strong></p>

                            <div style="margin:20px 0;">
                                <label style="display:block;margin-bottom:8px;color:var(--neon-blue);text-align:left;">Votre nom (pour l'attestation) :</label>
                                <input type="text" id="certificate-name-folder" placeholder="Pr√©nom NOM" style="
                                    width:100%;
                                    padding:12px 15px;
                                    background:rgba(0,50,100,0.4);
                                    border:2px solid rgba(0,212,255,0.4);
                                    border-radius:8px;
                                    color:white;
                                    font-size:1em;
                                    box-sizing:border-box;
                                ">
                            </div>

                            <button class="start-btn" onclick="downloadCertificateFromFolder()" style="background:linear-gradient(135deg,rgba(0,255,136,0.3),rgba(0,212,255,0.3));margin-top:10px;">
                                üì• T√©l√©charger l'attestation
                            </button>
                        </div>
                    </div>
                `;
            }

            const navItems = document.querySelectorAll('.briefing-nav-item');
            navItems.forEach(item => item.classList.remove('active'));
        }

        function unlockCertificate(score) {
            state.certificateUnlocked = true;
            state.finalScorePct = score;

            const navItem = $('certificate-nav-item');
            if (navItem) {
                navItem.style.opacity = '1';
                navItem.style.cursor = 'pointer';
                navItem.style.background = 'rgba(0,255,136,0.15)';
                navItem.innerHTML = `
                    <span class="nav-icon">üéì</span>
                    <span class="nav-number" style="background:rgba(0,255,136,0.3);color:var(--neon-green);">‚úì</span>
                    Attestation de r√©ussite
                `;
            }
        }

        // ==================== GAME FLOW ====================
        function startGame() {
            $('briefing-screen').classList.remove('active');
            $('game-container').classList.add('active');
            state.game.active = true;
            state.gameWasActive = true;
            state.game.casePhase = 0;
            state.game.caseId = null;
            state.game.casePoints = 0;
            state.game.evidenceFound = new Set();
            updateHUD();
            renderCaseSelection();
            renderDossierSide();
        }

        function openBriefingFromGame() {
            $('game-container').classList.remove('active');
            $('briefing-screen').classList.add('active');
            showLesson(currentLesson);

            // Update footer button to allow return to game
            const nextBtn = $('next-btn');
            nextBtn.style.visibility = 'visible';
            nextBtn.textContent = '‚öñÔ∏è Retour au tribunal';
            nextBtn.onclick = returnToGame;
        }

        function returnToGame() {
            $('briefing-screen').classList.remove('active');
            $('game-container').classList.add('active');
        }

        function exitToHome() {
            stopTimer();
            $('game-container').classList.remove('active');
            $('briefing-screen').classList.add('active');
            state.game.active = false;
            showLesson(currentLesson);
            toast("Retour au dossier.");
        }

        function updateHUD() {
            const g = state.game;
            $('credValue').textContent = g.credibility;
            const credPct = clamp(g.credibility, 0, 100);
            $('credFill').style.width = credPct + "%";
            $('credMeter').classList.toggle('danger', credPct < 45);
            $('caseIndex').textContent = g.casesDone.size;
            $('evidenceCount').textContent = g.evidenceFound.size;
            $('caseScore').textContent = g.casePoints;
        }

        function setCredibility(delta) {
            state.game.credibility = clamp(state.game.credibility + delta, 0, 100);
            updateHUD();
        }

        // ==================== TIMER ====================
        function startTimer() {
            stopTimer();
            state.game.secondsLeft = state.game.maxSeconds;
            tickTimer();
            state.game.timer = setInterval(() => {
                state.game.secondsLeft--;
                if (state.game.secondsLeft === 120) toast("‚è≥ Greffier : Plus que 2 minutes.");
                if (state.game.secondsLeft === 60) toast("‚ö†Ô∏è Greffier : 1 minute. Acc√©l√©rez.");
                if (state.game.secondsLeft === 30) toast("üö® Greffier : 30 secondes !");
                // Visual warning effects
                const gc = $('game-container');
                if (state.game.secondsLeft <= 30) {
                    gc.classList.remove('time-warning');
                    gc.classList.add('time-critical');
                } else if (state.game.secondsLeft <= 120) {
                    gc.classList.add('time-warning');
                    gc.classList.remove('time-critical');
                }
                tickTimer();
                if (state.game.secondsLeft <= 0) {
                    stopTimer();
                    toast("‚è±Ô∏è Temps √©coul√© : verdict pr√©cipit√© (p√©nalit√©).");
                    setCredibility(-12);
                    if (state.game.casePhase < 3) {
                        state.game.casePhase = 3;
                        renderVerdictPhase(true);
                    }
                }
            }, 1000);
        }

        function stopTimer() {
            if (state.game.timer) { clearInterval(state.game.timer); state.game.timer = null; }
            $('timeLeft').textContent = "--:--";
            const gc = $('game-container');
            gc.classList.remove('time-warning', 'time-critical');
        }

        function tickTimer() {
            const s = Math.max(0, state.game.secondsLeft);
            const mm = String(Math.floor(s / 60)).padStart(2, '0');
            const ss = String(s % 60).padStart(2, '0');
            $('timeLeft').textContent = `${mm}:${ss}`;
        }

        // ==================== CASE SELECTION ====================
        function renderCaseSelection() {
            stopTimer();
            const main = $('stageMain');

            main.innerHTML = `
                <div class="stage-title">
                    <h2 class="mono">Phase 1 ‚Äî Ouverture du dossier</h2>
                    <span class="tag">Choisissez une affaire</span>
                </div>
                <div class="muted" style="line-height:1.5;margin-bottom:10px">
                    Le greffier pr√©sente les dossiers. Vous devez juger <strong>3 affaires</strong>.
                    Chaque affaire : <strong>8 minutes</strong>.
                </div>

                <div class="case-grid">
                    ${renderCaseCard(cases.NEXUS)}
                    ${renderCaseCard(cases.MEDICA)}
                    ${renderCaseCard(cases.CREDITIA)}
                </div>

                ${state.game.casesDone.size === 3 ? `
                    <div class="hr"></div>
                    <div class="callout">
                        <strong>Tribunal :</strong> Les 3 affaires ont √©t√© jug√©es. Vous pouvez passer au <strong>quiz final</strong>.
                    </div>
                    <button class="btn primary" onclick="renderFinalQuiz()" style="margin-top:10px"><span>üßæ</span> Acc√©der au quiz final</button>
                ` : ``}

                <div class="hr"></div>
                <div class="callout purple">
                    <strong>Conseil de jur√© :</strong> avant de trancher, cherchez syst√©matiquement une preuve de <em>biais</em>,
                    une preuve de <em>supervision</em> (ou d'absence), et une preuve de <em>recours</em>.
                </div>
            `;

            renderDossierSide();
            state.game.casePhase = 0;
            state.game.caseId = null;
            state.game.evidenceFound = new Set();
            state.game.casePoints = 0;
            updateHUD();
        }

        function renderCaseCard(c) {
            const done = state.game.casesDone.has(c.code);
            const badge = done ? `<span class="badge">Jug√©e ‚úì</span>` : `<span class="badge">√Ä juger</span>`;
            const disabled = done ? 'style="opacity:.55; cursor:not-allowed;"' : '';
            const onclick = done ? '' : `onclick="selectCase('${c.code}')"`;
            return `
                <div class="case" ${onclick} ${disabled}>
                    ${badge}
                    <h3>${c.title}</h3>
                    <p>${c.teaser}</p>
                    <div class="hr"></div>
                    <div class="muted"><strong>Impact :</strong> ${c.impact}</div>
                </div>
            `;
        }

        function renderDossierSide() {
            const side = $('stageSide');
            const c = state.game.caseId ? cases[state.game.caseId] : null;

            const list = [...state.game.evidenceFound].map(id => {
                const ev = c ? c.evidence.find(x => x.id === id) : null;
                if (!ev) return "";
                return `<div class="item"><strong>${ev.k}</strong><small>${ev.hint}</small></div>`;
            }).join('');

            side.innerHTML = `
                <div class="judge-avatar">
                    <img src="images/ai_judge_avatar.png" alt="Juge" onerror="this.style.display='none'">
                    <div class="judge-info">
                        <div class="judge-name">Juge ARIA-7</div>
                        <div class="judge-role">Pr√©sidente du tribunal</div>
                    </div>
                </div>

                <div class="stage-title">
                    <h2 class="mono">Dossier du jur√©</h2>
                    <span class="tag">${c ? c.code : '‚Äî'}</span>
                </div>
                <div class="dossier">
                    <div class="item">
                        <strong>Statut</strong>
                        <small>${c ? c.title : 'Choisissez une affaire.'}</small>
                    </div>
                    <div class="item">
                        <strong>Preuves collect√©es</strong>
                        <small>${state.game.evidenceFound.size} / ${c ? c.evidence.length : 0}</small>
                    </div>
                    ${list || `<div class="item"><strong>Rien pour l'instant</strong><small>Collectez des preuves pour alimenter votre raisonnement.</small></div>`}
                </div>
            `;
        }

        // ==================== EVIDENCE PHASE ====================
        function selectCase(code) {
            if (state.game.casesDone.has(code)) return;
            state.game.caseId = code;
            state.game.casePhase = 1;
            state.game.evidenceFound = new Set();
            state.game.casePoints = 0;
            startTimer();
            renderEvidencePhase();
            renderDossierSide();
            toast(`Greffier : Dossier ${code} ouvert. Acc√®s aux archives autoris√©.`);
            updateHUD();
        }

        function renderEvidencePhase() {
            const c = cases[state.game.caseId];
            $('stageMain').innerHTML = `
                <div class="stage-title">
                    <h2 class="mono">Phase 2 ‚Äî Examen des preuves</h2>
                    <span class="tag">${c.code}</span>
                </div>

                <div class="callout">
                    <strong>Greffier :</strong> ${c.clerkIntro}
                </div>

                <div class="muted" style="margin-top:10px">Cliquez sur les pi√®ces √† conviction pour les analyser.</div>

                <div class="evidence-grid">
                    ${c.evidence.map(e => `
                        <div class="evidence" onclick="inspectEvidence('${e.id}')">
                            <div class="k">üìÑ ${e.k}</div>
                            <div class="v">${e.v}</div>
                        </div>
                    `).join('')}
                </div>

                <div class="hr"></div>
                <div style="display:flex; gap:10px; flex-wrap:wrap">
                    <button class="btn primary" onclick="goToPuzzle()" id="toPuzzleBtn" disabled><span>üß©</span> Reconstituer la cha√Æne</button>
                    <button class="btn" onclick="renderCaseSelection()"><span>‚Üê</span> Changer d'affaire</button>
                </div>
            `;
            updateToPuzzleBtn();
        }

        function updateToPuzzleBtn() {
            const btn = document.getElementById('toPuzzleBtn');
            if (!btn) return;
            btn.disabled = state.game.evidenceFound.size < 3;
        }

        function inspectEvidence(eid) {
            const c = cases[state.game.caseId];
            const e = c.evidence.find(x => x.id === eid);
            if (!e) return;

            if (!state.game.evidenceFound.has(eid)) {
                state.game.evidenceFound.add(eid);
                state.game.casePoints += e.points;
                toast(`+${e.points} pts ‚Ä¢ Indice : ${e.hint}`);
                renderDossierSide();
            } else {
                toast(`Indice d√©j√† collect√© : ${e.hint}`);
            }
            updateHUD();
            updateToPuzzleBtn();
        }

        // ==================== PUZZLE PHASE ====================
        function goToPuzzle() {
            state.game.casePhase = 2;
            toast("Greffier : Reconstituez maintenant la cha√Æne de responsabilit√©.");
            renderPuzzlePhase();
        }

        function renderPuzzlePhase() {
            const c = cases[state.game.caseId];
            const relevant = Object.values(c.puzzleCorrect);

            $('stageMain').innerHTML = `
                <div class="stage-title">
                    <h2 class="mono">Phase 3 ‚Äî Cha√Æne de responsabilit√©</h2>
                    <span class="tag">${c.code}</span>
                </div>
                <div class="muted" style="line-height:1.5">
                    Glissez-d√©posez les <strong>3 manquements</strong> sur le bon acteur.
                    Vert = coh√©rent, rose = incoh√©rent.
                </div>

                <div class="puzzle">
                    <div class="draglist">
                        <div class="mono" style="color:var(--neon-purple)">Manquements (3)</div>
                        ${relevant.map(k => `
                            <div class="drag" draggable="true" data-key="${k}">${k}</div>
                        `).join('')}
                    </div>
                    <div class="droplist">
                        <div class="mono" style="color:var(--neon-blue)">Acteurs</div>
                        <div class="drop" data-actor="Concepteur">
                            <strong>Concepteur / D√©veloppeur</strong>
                            <div class="slot">D√©posez ici‚Ä¶</div>
                        </div>
                        <div class="drop" data-actor="D√©ployeur">
                            <strong>D√©ployeur / Entreprise</strong>
                            <div class="slot">D√©posez ici‚Ä¶</div>
                        </div>
                        <div class="drop" data-actor="D√©cideur">
                            <strong>D√©cideur humain</strong>
                            <div class="slot">D√©posez ici‚Ä¶</div>
                        </div>
                        <div class="hr"></div>
                        <div style="display:flex;gap:10px;flex-wrap:wrap">
                            <button class="btn" onclick="resetPuzzle()"><span>‚Ü∫</span> R√©initialiser</button>
                            <button class="btn primary" onclick="goToVerdict()"><span>‚öñÔ∏è</span> Passer au verdict</button>
                        </div>
                    </div>
                </div>
            `;

            wireDragDrop(c.puzzleCorrect);
        }

        function resetPuzzle() {
            renderPuzzlePhase();
            toast("Puzzle r√©initialis√©.");
        }

        function wireDragDrop(correctMap) {
            const drags = document.querySelectorAll('.drag');
            const drops = document.querySelectorAll('.drop');
            const assigned = new Map();
            let selectedDrag = null; // For tap-to-place on mobile

            function placePiece(key, actor, drop) {
                if ([...assigned.values()].includes(key) && assigned.get(actor) !== key) {
                    toast("Ce manquement est d√©j√† utilis√© ailleurs.");
                    return;
                }

                assigned.set(actor, key);
                const slot = drop.querySelector('.slot');
                slot.textContent = key;

                const expected = correctMap[actor];
                const ok = expected === key;
                drop.classList.remove('good', 'bad', 'awaiting');
                drop.classList.add(ok ? 'good' : 'bad');

                if (ok) {
                    toast(`‚úì Coh√©rent : ${actor} ‚Üî ${key} (+6 pts)`);
                    state.game.casePoints += 6;
                } else {
                    toast(`‚úó Incoh√©rent : ${actor} ‚Üî ${key} (-cr√©dibilit√©)`);
                    setCredibility(-6);
                }
                updateHUD();

                // Clear selection
                drags.forEach(d => d.classList.remove('selected'));
                drops.forEach(d => d.classList.remove('awaiting'));
                selectedDrag = null;
            }

            // Desktop drag-drop
            drags.forEach(d => {
                d.addEventListener('dragstart', (ev) => {
                    ev.dataTransfer.setData('text/plain', d.dataset.key);
                    ev.dataTransfer.effectAllowed = 'move';
                });
            });

            drops.forEach(drop => {
                drop.addEventListener('dragover', (ev) => { ev.preventDefault(); ev.dataTransfer.dropEffect = 'move'; });
                drop.addEventListener('drop', (ev) => {
                    ev.preventDefault();
                    const key = ev.dataTransfer.getData('text/plain');
                    const actor = drop.dataset.actor;
                    placePiece(key, actor, drop);
                });
            });

            // Mobile/touch: tap to select, tap to place
            drags.forEach(d => {
                d.addEventListener('click', () => {
                    if (selectedDrag === d.dataset.key) {
                        // Deselect
                        d.classList.remove('selected');
                        drops.forEach(dr => dr.classList.remove('awaiting'));
                        selectedDrag = null;
                    } else {
                        // Select this drag
                        drags.forEach(x => x.classList.remove('selected'));
                        d.classList.add('selected');
                        selectedDrag = d.dataset.key;
                        // Highlight available drop zones
                        drops.forEach(dr => {
                            if (dr.dataset.actor) dr.classList.add('awaiting');
                        });
                        toast("Touchez un acteur pour y d√©poser ce manquement.");
                    }
                });
            });

            drops.forEach(drop => {
                drop.addEventListener('click', () => {
                    if (!selectedDrag || !drop.dataset.actor) return;
                    placePiece(selectedDrag, drop.dataset.actor, drop);
                });
            });
        }

        // ==================== VERDICT PHASE ====================
        function goToVerdict() {
            state.game.casePhase = 3;
            toast("Greffier : Le tribunal attend votre d√©cision.");
            renderVerdictPhase(false);
        }

        function renderVerdictPhase(fromTimeout) {
            const c = cases[state.game.caseId];

            $('stageMain').innerHTML = `
                <div class="stage-title">
                    <h2 class="mono">Phase 4 ‚Äî Verdict</h2>
                    <span class="tag">${c.code}</span>
                </div>

                ${fromTimeout ? `<div class="callout pink"><strong>Temps √©coul√© :</strong> verdict pr√©cipit√© ‚Üí cr√©dibilit√© fragile.</div><div class="hr"></div>` : ''}

                <div class="muted" style="line-height:1.55">
                    S√©lectionnez le(s) responsable(s) et les sanctions adapt√©es.
                </div>

                <div class="choices">
                    <div class="choice">
                        <h4>Responsables principaux</h4>
                        ${["Concepteur", "D√©ployeur", "D√©cideur"].map(x => `
                            <label><input type="checkbox" name="resp" value="${x}"> <span>${x}</span></label>
                        `).join('')}
                    </div>
                    <div class="choice">
                        <h4>Sanctions / mesures</h4>
                        ${[
                            "Amende proportionn√©e",
                            "Retrait temporaire du syst√®me",
                            "Obligation de transparence",
                            "Formation obligatoire",
                            "Audit externe",
                            "Mise en place d'un recours humain",
                            "Mise √† jour interface + incertitudes"
                        ].map(x => `
                            <label><input type="checkbox" name="san" value="${x}"> <span>${x}</span></label>
                        `).join('')}
                    </div>
                </div>

                <div class="hr"></div>
                <button class="btn primary" onclick="submitVerdict()"><span>‚úÖ</span> Enregistrer le verdict</button>
            `;

            $('stageSide').innerHTML = `
                <div class="stage-title">
                    <h2 class="mono">Conseiller juridique</h2>
                    <span class="tag">Aide</span>
                </div>
                <div class="dossier">
                    <div class="item"><strong>√Ä v√©rifier</strong><small>Impact √©lev√© ‚Üí supervision humaine r√©elle, transparence, recours, documentation.</small></div>
                    <div class="item"><strong>Indices collect√©s</strong><small>${state.game.evidenceFound.size} preuve(s).</small></div>
                    <div class="item"><strong>Attention</strong><small>Cocher "tout le monde responsable" sans justification = p√©nalit√© de cr√©dibilit√©.</small></div>
                </div>
            `;
        }

        function submitVerdict() {
            const c = cases[state.game.caseId];
            const chosenResp = [...document.querySelectorAll('input[name="resp"]:checked')].map(x => x.value);
            const chosenSan = [...document.querySelectorAll('input[name="san"]:checked')].map(x => x.value);

            let pts = 0;
            const correctResp = new Set(c.verdict.responsibles);
            const chosenSet = new Set(chosenResp);
            const correctHits = [...chosenSet].filter(x => correctResp.has(x)).length;
            const falsePos = [...chosenSet].filter(x => !correctResp.has(x)).length;

            pts += correctHits * 10;
            pts -= falsePos * 6;

            const correctSan = new Set(c.verdict.sanctions);
            const sanHits = chosenSan.filter(x => correctSan.has(x)).length;
            const sanFalse = chosenSan.filter(x => !correctSan.has(x)).length;

            pts += sanHits * 7;
            pts -= sanFalse * 4;
            pts += Math.min(12, state.game.evidenceFound.size * 3);

            if (chosenResp.length === 0) { setCredibility(-8); pts -= 8; }
            if (chosenResp.length === 3 && correctResp.size < 3) { setCredibility(-6); pts -= 6; }

            state.game.casePoints += pts;
            if (correctHits === 0 || sanHits === 0) setCredibility(-10);

            state.game.casesDone.add(c.code);
            state.game.totalPoints += Math.max(0, state.game.casePoints);

            toast(`Greffier : Verdict enregistr√© ‚Ä¢ +${Math.max(0, pts)} pts`);
            stopTimer();

            // Build detailed breakdown
            const respRows = ["Concepteur", "D√©ployeur", "D√©cideur"].map(r => {
                const expected = correctResp.has(r);
                const chosen = chosenSet.has(r);
                const match = expected === chosen;
                return `<tr>
                    <td>${r}</td>
                    <td>${expected ? '‚úì Attendu' : '‚Äî'}</td>
                    <td>${chosen ? '‚úì Coch√©' : '‚Äî'}</td>
                    <td class="${match ? 'match' : 'miss'}">${match ? '‚úì' : '‚úó'}</td>
                </tr>`;
            }).join('');

            const sanRows = [...new Set([...c.verdict.sanctions, ...chosenSan])].map(s => {
                const expected = correctSan.has(s);
                const chosen = chosenSan.includes(s);
                const match = expected === chosen;
                return `<tr>
                    <td>${s}</td>
                    <td>${expected ? '‚úì' : '‚Äî'}</td>
                    <td>${chosen ? '‚úì' : '‚Äî'}</td>
                    <td class="${match ? 'match' : 'miss'}">${match ? '‚úì' : '‚úó'}</td>
                </tr>`;
            }).join('');

            $('stageMain').innerHTML = `
                <div class="stage-title">
                    <h2 class="mono">Verdict enregistr√©</h2>
                    <span class="tag">${c.code}</span>
                </div>
                <div class="callout">
                    <strong>Analyse attendue :</strong> ${c.verdict.rationale}
                </div>

                <div class="hr"></div>
                <div class="muted" style="margin-bottom:6px"><strong>D√©tail ‚Äî Responsables</strong></div>
                <table class="verdict-table">
                    <tr><th>Acteur</th><th>Attendu</th><th>Votre choix</th><th></th></tr>
                    ${respRows}
                </table>

                <div class="muted" style="margin-bottom:6px;margin-top:12px"><strong>D√©tail ‚Äî Sanctions</strong></div>
                <table class="verdict-table">
                    <tr><th>Mesure</th><th>Attendue</th><th>Votre choix</th><th></th></tr>
                    ${sanRows}
                </table>

                <div class="hr"></div>
                <div class="muted"><strong>Score d'affaire :</strong> ${state.game.casePoints} pts ‚Ä¢ <strong>Cr√©dibilit√© :</strong> ${state.game.credibility}/100</div>
                <div class="hr"></div>
                <div style="display:flex;gap:10px;flex-wrap:wrap">
                    <button class="btn primary" onclick="nextAfterCase()"><span>‚Üí</span> Continuer</button>
                </div>
            `;

            renderDossierSide();
            updateHUD();
        }

        function nextAfterCase() {
            if (state.game.credibility <= 0) {
                $('stageMain').innerHTML = `
                    <div class="stage-title">
                        <h2 class="mono">Cr√©dibilit√© √©puis√©e</h2>
                        <span class="tag">√âchec</span>
                    </div>
                    <div class="callout pink">Votre cr√©dibilit√© est tomb√©e √† 0. Recommencez le tribunal.</div>
                    <div class="hr"></div>
                    <button class="btn danger" onclick="restartTribunal()"><span>‚Üª</span> Recommencer</button>
                `;
                stopTimer();
                return;
            }

            if (state.game.casesDone.size < 3) {
                renderCaseSelection();
                toast("Choisissez la prochaine affaire.");
            } else {
                toast("üì£ Greffier : Les 3 affaires sont closes. Passage au quiz final.");
                renderFinalQuiz();
            }
        }

        function restartTribunal() {
            state.game.casesDone = new Set();
            state.game.credibility = 100;
            state.game.totalPoints = 0;
            startGame();
        }

        // ==================== FINAL QUIZ ====================
        function renderFinalQuiz() {
            state.game.casePhase = 4;
            stopTimer();

            $('stageMain').innerHTML = `
                <div class="stage-title">
                    <h2 class="mono">Quiz final ‚Äî Certification</h2>
                    <span class="tag">10 questions</span>
                </div>
                <div class="callout purple"><strong>R√®gle :</strong> vous devez atteindre <strong>70%</strong> pour valider et d√©bloquer l'attestation.</div>
                <div class="hr"></div>
                <div class="quiz" id="quizHost">${quizHTML()}</div>
                <div class="hr"></div>
                <button class="btn primary" onclick="gradeQuiz()"><span>üßæ</span> Corriger & calculer le score</button>
                <div id="quizResult" class="muted" style="margin-top:12px; line-height:1.55"></div>
            `;

            $('stageSide').innerHTML = `
                <div class="stage-title">
                    <h2 class="mono">Rappel</h2>
                    <span class="tag">Cadres</span>
                </div>
                <div class="dossier">
                    <div class="item"><strong>AI Act</strong><small>Approche par niveaux de risque + obligations. Sanctions jusqu'√† 35 M‚Ç¨ ou 7% CA.</small></div>
                    <div class="item"><strong>HITL</strong><small>Humain comp√©tent qui peut contester et renverser la recommandation.</small></div>
                    <div class="item"><strong>RGPD (art. 22)</strong><small>Droit de ne pas √™tre soumis √† une d√©cision fond√©e uniquement sur un traitement automatis√©.</small></div>
                </div>
            `;
        }

        function quizHTML() {
            return `
                <div class="q">
                    <h4>Q1. Responsabilit√© humaine (QCM)</h4>
                    <div class="muted">Quelle affirmation d√©crit le mieux la responsabilit√© humaine quand une IA est utilis√©e dans une d√©cision √† fort impact ?</div>
                    <label><input type="radio" name="q1" value="a"> L'IA est enti√®rement responsable.</label>
                    <label><input type="radio" name="q1" value="b"> L'humain qui d√©finit l'objectif et valide la d√©cision reste responsable.</label>
                    <label><input type="radio" name="q1" value="c"> Le d√©veloppeur est seul responsable.</label>
                    <label><input type="radio" name="q1" value="d"> Aucun responsable n'est n√©cessaire.</label>
                </div>
                <div class="q">
                    <h4>Q2. Cas o√π la responsabilit√© est la plus difficile (QCM)</h4>
                    <label><input type="radio" name="q2" value="a"> IA m√©dicale recommandant un traitement sur donn√©es biais√©es.</label>
                    <label><input type="radio" name="q2" value="b"> IA de traduction avec erreur sans cons√©quence majeure.</label>
                    <label><input type="radio" name="q2" value="c"> IA g√©n√©rant une image inattendue.</label>
                    <label><input type="radio" name="q2" value="d"> IA d'astuces m√©nag√®res inutiles.</label>
                </div>
                <div class="q">
                    <h4>Q3. AI Act & transparence (Vrai/Faux)</h4>
                    <div class="muted">¬´ Selon l'AI Act, toute d√©cision prise par une IA doit √™tre transparente pour l'utilisateur final. ¬ª</div>
                    <label><input type="radio" name="q3" value="v"> Vrai</label>
                    <label><input type="radio" name="q3" value="f"> Faux</label>
                </div>
                <div class="q">
                    <h4>Q4. M√©canisme protecteur (QCM)</h4>
                    <div class="muted">Quel m√©canisme prot√®ge g√©n√©ralement l'utilisateur quand une IA influence une d√©cision importante ?</div>
                    <label><input type="radio" name="q4" value="a"> Immunit√© totale pour l'entreprise</label>
                    <label><input type="radio" name="q4" value="b"> Obligation de human-in-the-loop</label>
                    <label><input type="radio" name="q4" value="c"> Aucune responsabilit√©</label>
                    <label><input type="radio" name="q4" value="d"> Audit al√©atoire apr√®s 10 ans</label>
                </div>
                <div class="q">
                    <h4>Q5. √âthique (cases √† cocher)</h4>
                    <div class="muted">Cochez toutes les responsabilit√©s qui s'appliquent dans un cadre √©thique :</div>
                    <label><input type="checkbox" name="q5" value="a"> Transparence sur l'usage de l'IA</label>
                    <label><input type="checkbox" name="q5" value="b"> Droit √† une explication compr√©hensible</label>
                    <label><input type="checkbox" name="q5" value="c"> Suppression automatique de toutes les donn√©es</label>
                    <label><input type="checkbox" name="q5" value="d"> Intervention humaine si risque √©lev√©</label>
                </div>
                <div class="q">
                    <h4>Q6. Responsabilit√© malgr√© usage non pr√©vu (Vrai/Faux)</h4>
                    <div class="muted">¬´ Une entreprise peut √™tre tenue responsable si un syst√®me IA cause un dommage, m√™me si l'algorithme n'√©tait pas pr√©vu pour cette t√¢che. ¬ª</div>
                    <label><input type="radio" name="q6" value="v"> Vrai</label>
                    <label><input type="radio" name="q6" value="f"> Faux</label>
                </div>
                <div class="q">
                    <h4>Q7. Diligence maximale (QCM)</h4>
                    <div class="muted">Quelle situation n√©cessite le plus haut niveau de diligence humaine ?</div>
                    <label><input type="radio" name="q7" value="a"> IA triant des livres</label>
                    <label><input type="radio" name="q7" value="b"> IA recommandant des diagnostics m√©dicaux</label>
                    <label><input type="radio" name="q7" value="c"> IA g√©n√©rant des slogans</label>
                    <label><input type="radio" name="q7" value="d"> IA triant des photos</label>
                </div>
                <div class="q">
                    <h4>Q8. Question ouverte courte</h4>
                    <div class="muted">Donnez deux raisons pour lesquelles l'√©thique est importante dans les d√©cisions assist√©es par IA (1‚Äì2 phrases).</div>
                    <textarea id="q8" placeholder="Votre r√©ponse‚Ä¶"></textarea>
                </div>
                <div class="q">
                    <h4>Q9. Cas pratique (QCM)</h4>
                    <div class="muted">Une IA d'octroi de pr√™t rejette un dossier sans explication ; la candidate perd son logement. Quel probl√®me est le plus probable ?</div>
                    <label><input type="radio" name="q9" value="a"> L'IA avait suffisamment de donn√©es</label>
                    <label><input type="radio" name="q9" value="b"> La transparence est insuffisante</label>
                    <label><input type="radio" name="q9" value="c"> L'IA a √©t√© trop lente</label>
                    <label><input type="radio" name="q9" value="d"> C'est forc√©ment une erreur de code</label>
                </div>
                <div class="q">
                    <h4>Q10. Obligations possibles (cases √† cocher)</h4>
                    <div class="muted">Cochez toutes les obligations potentielles pour une entreprise dans un cadre r√©glementaire IA :</div>
                    <label><input type="checkbox" name="q10" value="a"> Documentation compl√®te des jeux de donn√©es</label>
                    <label><input type="checkbox" name="q10" value="b"> Suppression de toutes les donn√©es client sans exception</label>
                    <label><input type="checkbox" name="q10" value="c"> D√©montrer la supervision humaine dans les d√©cisions √† risque</label>
                    <label><input type="checkbox" name="q10" value="d"> Ne tester que des mod√®les non document√©s</label>
                </div>
            `;
        }

        function gradeQuiz() {
            const key = { q1: "b", q2: "a", q3: "f", q4: "b", q5: ["a", "b", "d"], q6: "v", q7: "b", q9: "b", q10: ["a", "c"] };

            let correct = 0;
            const total = 10;

            function getRadio(name) {
                const el = document.querySelector(`input[name="${name}"]:checked`);
                return el ? el.value : null;
            }
            function getChecks(name) {
                return [...document.querySelectorAll(`input[name="${name}"]:checked`)].map(x => x.value).sort();
            }
            function sameArray(a, b) {
                if (a.length !== b.length) return false;
                for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;
                return true;
            }

            if (getRadio("q1") == key.q1) correct++;
            if (getRadio("q2") == key.q2) correct++;
            if (getRadio("q3") == key.q3) correct++;
            if (getRadio("q4") == key.q4) correct++;
            if (sameArray(getChecks("q5"), key.q5.slice().sort())) correct++;
            if (getRadio("q6") == key.q6) correct++;
            if (getRadio("q7") == key.q7) correct++;

            const ans8 = (document.getElementById("q8").value || "").toLowerCase();
            const kw = [
                ["droits", "dignit√©", "humain"],
                ["biais", "discrimination", "√©quit√©", "justice"],
                ["transparence", "explication", "compr√©hensible"],
                ["pr√©judice", "dommage", "s√©curit√©"],
                ["responsabilit√©", "supervision", "contr√¥le", "hitl"]
            ];
            let hits = 0;
            kw.forEach(group => { if (group.some(w => ans8.includes(w))) hits++; });
            if (hits >= 2 && ans8.trim().length >= 20) correct++;

            if (getRadio("q9") == key.q9) correct++;
            if (sameArray(getChecks("q10"), key.q10.slice().sort())) correct++;

            const pct = Math.round((correct / total) * 100);
            state.quiz.done = true;
            state.quiz.scorePct = pct;

            const tribunalBonus = clamp(Math.round((state.game.credibility / 100) * 10), 0, 10);
            const finalPct = clamp(pct + tribunalBonus, 0, 100);
            state.finalScorePct = finalPct;

            const passed = finalPct >= 70;
            const msg = passed
                ? `‚úÖ Score quiz : <strong>${pct}%</strong> + bonus tribunal : <strong>${tribunalBonus}</strong> ‚Üí <strong style="color:var(--neon-green)">${finalPct}%</strong><br><span class="mono">Attestation d√©bloqu√©e.</span>`
                : `‚ùå Score quiz : <strong>${pct}%</strong> + bonus tribunal : <strong>${tribunalBonus}</strong> ‚Üí <strong style="color:var(--neon-pink)">${finalPct}%</strong><br>Objectif : <strong>70%</strong>. Relisez le briefing et recommencez.`;

            document.getElementById("quizResult").innerHTML = msg;

            // Highlight correct/incorrect answers
            highlightQuizAnswers(key);

            if (passed) {
                unlockCertificate(finalPct);
                toast("üéì Attestation d√©bloqu√©e !");
                launchCelebration();
                $('stageMain').innerHTML += `
                    <div class="hr"></div>
                    <div class="callout">
                        <strong>Prochaine √©tape :</strong> ouvrez le <em>Briefing</em> puis l'onglet <strong>Attestation</strong> pour t√©l√©charger.
                    </div>
                `;
            } else {
                setCredibility(-6);
                toast("Score insuffisant : p√©nalit√© de cr√©dibilit√© (-6).");
            }

            updateHUD();
        }

        // ==================== QUIZ FEEDBACK ====================
        function highlightQuizAnswers(key) {
            const questions = document.querySelectorAll('.q');
            const names = ['q1','q2','q3','q4','q5','q6','q7','q8','q9','q10'];

            questions.forEach((q, i) => {
                const name = names[i];
                if (!name) return;
                const k = key[name];
                if (!k) { q.classList.add('correct'); return; } // q8 open - skip

                let isCorrect = false;
                if (Array.isArray(k)) {
                    const checked = [...q.querySelectorAll(`input[name="${name}"]:checked`)].map(x => x.value).sort();
                    isCorrect = checked.length === k.length && checked.every((v, j) => v === k.slice().sort()[j]);
                } else {
                    const checked = q.querySelector(`input[name="${name}"]:checked`);
                    isCorrect = checked && checked.value === k;
                }

                q.classList.add(isCorrect ? 'correct' : 'incorrect');

                // Show correct answer for incorrect ones
                if (!isCorrect && !Array.isArray(k)) {
                    const correctLabel = q.querySelector(`input[value="${k}"]`)?.parentElement;
                    if (correctLabel) {
                        correctLabel.style.color = 'var(--neon-green)';
                        correctLabel.style.fontWeight = '600';
                    }
                    const fb = document.createElement('div');
                    fb.className = 'answer-feedback ko';
                    fb.textContent = `R√©ponse attendue : ${k.toUpperCase()}`;
                    q.appendChild(fb);
                } else if (isCorrect) {
                    const fb = document.createElement('div');
                    fb.className = 'answer-feedback ok';
                    fb.textContent = '‚úì Correct';
                    q.appendChild(fb);
                }
            });
        }

        // ==================== CELEBRATION ====================
        function launchCelebration() {
            const colors = ['#00ff88', '#00d4ff', '#ff0080', '#a855f7', '#ffe66d', '#ff6b6b'];
            for (let i = 0; i < 60; i++) {
                const el = document.createElement('div');
                el.className = 'confetti';
                el.style.left = Math.random() * 100 + 'vw';
                el.style.top = '-10px';
                el.style.background = colors[Math.floor(Math.random() * colors.length)];
                el.style.width = (Math.random() * 8 + 5) + 'px';
                el.style.height = (Math.random() * 8 + 5) + 'px';
                el.style.animationDelay = Math.random() * 1.5 + 's';
                el.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 5000);
            }
        }

        // ==================== CERTIFICATE ====================
        function downloadCertificateFromFolder() {
            const name = (document.getElementById('certificate-name-folder')?.value || "").trim() || "Participant";
            const date = new Date().toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });
            generateCertificateHTML(name, date, state.finalScorePct);
        }

        function generateCertificateHTML(name, date, score) {
            const certificateHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Attestation - Responsabilit√© humaine & IA</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Open+Sans:wght@400;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1a2d4a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .certificate {
            background: linear-gradient(180deg, #0d1f35 0%, #162840 100%);
            border: 3px solid #00ff88;
            border-radius: 20px;
            padding: 50px 60px;
            max-width: 800px;
            width: 100%;
            position: relative;
            box-shadow: 0 0 60px rgba(0,255,136,0.3), inset 0 0 60px rgba(0,212,255,0.1);
        }
        .certificate::before {
            content: '';
            position: absolute;
            top: 15px; left: 15px; right: 15px; bottom: 15px;
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 15px;
            pointer-events: none;
        }
        .header { text-align: center; margin-bottom: 40px; }
        .logo { font-size: 3em; margin-bottom: 10px; }
        .title {
            font-family: 'Playfair Display', serif;
            font-size: 2.5em;
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 5px;
        }
        .subtitle-cert { color: #00d4ff; font-size: 1.1em; letter-spacing: 3px; text-transform: uppercase; }
        .content { text-align: center; color: #e0e0e0; line-height: 1.8; }
        .certifies { font-size: 1.1em; margin: 30px 0 15px; }
        .name {
            font-family: 'Playfair Display', serif;
            font-size: 2.2em;
            color: #ffffff;
            margin: 20px 0;
            padding: 15px 0;
            border-top: 1px solid rgba(0,212,255,0.3);
            border-bottom: 1px solid rgba(0,212,255,0.3);
        }
        .module {
            background: rgba(0,255,136,0.1);
            border: 1px solid rgba(0,255,136,0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
        }
        .module-name { color: #00ff88; font-size: 1.3em; font-weight: 600; margin-bottom: 10px; }
        .score-badge {
            display: inline-block;
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            color: #0a1628;
            padding: 8px 25px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
        }
        .footer {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid rgba(0,212,255,0.2);
        }
        .footer-item { text-align: center; }
        .footer-label { color: #888; font-size: 0.85em; margin-bottom: 5px; }
        .footer-value { color: #00d4ff; font-weight: 600; }
        .skills {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        .skill {
            background: rgba(0,212,255,0.1);
            border: 1px solid rgba(0,212,255,0.3);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            color: #00d4ff;
        }
        @media print {
            body { background: white; }
            .certificate { box-shadow: none; border-width: 2px; }
        }
    </style>
</head>
<body>
    <div class="certificate">
        <div class="header">
            <div class="logo">‚öñÔ∏èü§ñ</div>
            <div class="title">Attestation de R√©ussite</div>
            <div class="subtitle-cert">Formation IA Responsable</div>
        </div>
        <div class="content">
            <p class="certifies">Cette attestation certifie que</p>
            <div class="name">${name}</div>
            <p>a compl√©t√© avec succ√®s le micro-module</p>
            <div class="module">
                <div class="module-name">‚öñÔ∏è Responsabilit√© Humaine & Intelligence Artificielle</div>
                <p>via la simulation immersive "Le Tribunal de l'IA"</p>
                <div class="score-badge">Score : ${score}%</div>
            </div>
            <p>Comp√©tences valid√©es :</p>
            <div class="skills">
                <span class="skill">üîó Cha√Æne de responsabilit√©</span>
                <span class="skill">üá™üá∫ AI Act</span>
                <span class="skill">ü§ù √âthique de l'IA</span>
                <span class="skill">üßë‚Äç‚öñÔ∏è Human-in-the-loop</span>
                <span class="skill">üß† Analyse critique</span>
            </div>
        </div>
        <div class="footer">
            <div class="footer-item">
                <div class="footer-label">Date d'obtention</div>
                <div class="footer-value">${date}</div>
            </div>
            <div class="footer-item">
                <div class="footer-label">R√©f√©rence</div>
                <div class="footer-value">IA-RESP-${Date.now().toString(36).toUpperCase()}</div>
            </div>
            <div class="footer-item">
                <div class="footer-label">Validit√©</div>
                <div class="footer-value">Permanente</div>
            </div>
        </div>
        <div style="margin-top:30px;padding-top:20px;border-top:1px solid rgba(0,212,255,0.2);text-align:center;">
            <p style="color:#8899aa;font-size:0.85em;margin-bottom:10px;">Une formation propos√©e par</p>
            <a href="https://www.profexpress.com" target="_blank" style="display:inline-block;">
                <img src="images/logo-profexpress.png" alt="Prof Express" style="height:35px;object-fit:contain;">
            </a>
        </div>
    </div>
</body>
</html>`;

            const blob = new Blob([certificateHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Attestation_IA_Responsabilite_${name.replace(/\s+/g, '_')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ==================== INIT ====================
        showLesson(0);
    </script>
</body>
</html>
